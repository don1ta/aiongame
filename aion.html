<!DOCTYPE html>
<html lang="zh-Hant-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="referrer" content="no-referrer">

    <!-- 網頁標題 (瀏覽器分頁顯示) -->
    <title>Aion2 高階解析 - 角色名稱快速查詢版</title>

    <!-- Line / Facebook 等社群軟體分享時顯示的設定 (Open Graph) -->
    <meta property="og:title" content="Aion2 高階解析 - 角色查詢系統">
    <meta property="og:description" content="快速查詢 Aion2 遊戲內的角色裝備、被動技能、戰力指標與健檢分析-Web design don1">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://don1ta.github.io/aiongame/aion.html">
    <meta property="og:site_name" content="Web design don1">
    <!-- 引入外部 CSS -->
    <link rel="stylesheet" href="css/aion.css?v=anti_shake_v1">
    <link rel="stylesheet" href="css/search.css?v=score_colors_v4">

    <!-- 引入共用配置與圖表庫 -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script
        src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
</head>


<body>
    <div id="loading" class="loading-overlay">⌛ 正在從伺服器獲取數據，請稍候...</div>

    <!-- 📓 作者日記入口 -->
    <div class="diary-float-btn" onclick="window.openAuthorDiary()" title="作者日記">
        <span>📓</span>
    </div>

    <div class="container">
        <div class="input-area" id="nav-target-role" style="scroll-margin-top: 15px;">
            <h2 style="color:var(--gold); margin-top:0; text-align: center;">💎 Aion2 角色數據查詢系統</h2>

            <div class="import-section">
                <div style="font-size: 14px; color: var(--gold); font-weight: bold;">🔍 角色查詢</div>
                <div class="api-input-group">
                    <input type="text" id="charNameInput" placeholder="輸入角色名稱 (例如: 我愛小紅線)..." oninput="fetchFromApi()"
                        onkeydown="if(event.key === 'Enter') fetchFromApi()" autocomplete="off">



                    <button class="btn-api" onclick="fetchFromApi()" style="display:none;">立即查詢</button>
                </div>

                興趣製作非商業用途，請勿用於營利行為，資料有誤依官方為主。
            </div>
        </div>

        <!-- 搜尋結果區塊 -->
        <div id="search-results" class="search-results-grid" style="display:none;"></div>

        <div id="main-content" class="dashboard">

            <!-- 裝備分析系統：整合式大型區塊 -->
            <!-- 裝備分析系統：整合式左資訊/右分頁佈局 -->
            <div class="card" style="margin-bottom: 30px; padding: 0; overflow: hidden;">
                <div class="split-integrated-layout layout-fixed-height" style="display: flex; align-items: stretch;">
                    <!-- 左側固定欄：個人資訊 -->
                    <div class="equip-sidebar-profile" id="equip-sidebar-profile"
                        style="width: 280px; background: rgba(0,0,0,0.2); border-right: 1px solid var(--border); padding: 30px 20px; display: flex; flex-direction: column; align-items: center; gap: 20px;">
                        <!-- 角色資訊由 JS processData 動態填充至 new-profile-header -->
                        <div id="new-profile-header"
                            style="display:none; width:100%; flex-direction:column; align-items:center; gap:15px;">
                        </div>
                    </div>

                    <!-- 右側動態欄：分頁切換內容 -->
                    <div class="equip-main-content" id="nav-target-equip"
                        style="flex: 1; display: flex; flex-direction: column; padding: 25px; scroll-margin-top: 20px;">
                        <div class="integrated-equip-header"
                            style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                            <div class="header-title" style="display: flex; align-items: center; gap: 10px;">
                                <span class="icon" style="font-size: 25px;">💫</span>
                                <h3 id="integrated-header-title"
                                    style="margin: 0; border: none; padding: 0; color: var(--gold-bright); font-size: 20px;">
                                    基本資料</h3>
                            </div>
                            <div class="stat-tabs-header integrated-tabs" style="margin-bottom: 0;">
                                <div id="tab-btn-equip-layout" class="stat-tab-btn active"
                                    onclick="switchEquipTab('layout')">基本佈覽</div>
                                <div id="tab-btn-equip-simple" class="stat-tab-btn" onclick="switchEquipTab('simple')">
                                    簡易</div>
                                <div id="tab-btn-equip-detail" class="stat-tab-btn" onclick="switchEquipTab('detail')">
                                    完整</div>
                            </div>
                        </div>


                        <div id="integrated-tab-content-area"
                            style="flex: 1; position: relative; overflow-y: auto; overflow-x: hidden; padding-right: 5px;">
                            <!-- 基本佈覽 -->
                            <div id="equip-tab-layout" style="display:block;"></div>

                            <!-- 簡易清單 -->
                            <div id="equip-tab-simple" style="display:none;">
                                <div class="mini-section-header"
                                    style="display:flex; justify-content:space-between; align-items:center; padding:10px ;">
                                    <span>⚔️ 武器與防具</span>
                                    <!-- 📸 全能量門截圖按鈕 - 放在此處擷取整個簡易分頁 -->
                                    <div id="btn-equip-screenshot" class="stat-tab-btn"
                                        style="background: rgba(46, 204, 113, 0.2); color: #2ecc71; margin: 0; padding: 4px 15px; font-size: 12px; border: 1px solid rgba(46, 204, 113, 0.3);"
                                        onclick="window.downloadEquipScreenshot()">📸 一鍵截圖 </div>
                                </div>
                                <div id="equip-armor-list-simple" class="grid-box-container"
                                    style="grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));"></div>
                                <div class="mini-section-header" style="padding:10px ;">📿 飾品與配件</div>
                                <div id="equip-accessory-list-simple" class="grid-box-container"
                                    style="grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));"></div>
                            </div>

                            <!-- 完整細項 -->
                            <div id="equip-tab-detail" style="display:none;">
                                <div class="mini-section-header" style="padding:10px">⚔️ 武器與防具</div>
                                <div id="equip-armor-list"></div>
                                <div class="mini-section-header" style="padding:10px">📿 飾品與配件</div>
                                <div id="equip-accessory-list"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="main-layout-wrapper">
                <div class="left-column">

                    <div class="stats-source-wrapper"
                        style="display:flex; gap:15px; align-items:stretch; flex-direction:column;">
                        <div class="card" id="nav-target-index" style="flex:1;">

                            <div id="equip-source-grid"></div>
                            「職業不同、實戰價值」會影響評分公正性是合理的。
                        </div>


                    </div>


                    <!-- Toggle Tabs for History vs Class Distribution -->
                    <div class="card">
                        <div class="card-header-tabs"
                            style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px; border-bottom:1px solid rgba(255,255,255,0.1); padding-bottom:10px;">
                            <div style="display:flex; gap:15px;">
                                <div id="tab-btn-trend" class="stat-tab-btn active"
                                    onclick="switchMainChartTab('trend')">📊 歷史趨勢</div>
                                <div id="tab-btn-class" class="stat-tab-btn" onclick="switchMainChartTab('class')">👥
                                    職業分布</div>
                                <div id="tab-btn-server" class="stat-tab-btn" onclick="switchMainChartTab('server')">🏢
                                    全伺服器</div>
                            </div>
                        </div>

                        <div id="tab-content-trend" style="display:block;">
                            <div id="p-ranking-new" class="rank-grid-new" style="margin-top:0;"></div>
                            <div id="trend-chart-container"
                                style="position: relative; height: 350px; margin-top: 15px;">
                                <canvas id="trend-chart"></canvas>
                            </div>
                            <div id="trend-info"
                                style="margin-top: 15px; font-size: 13px; color: #8b949e; text-align: center;"></div>
                        </div>


                        <div id="tab-content-class" style="display:none;">
                            <div
                                style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px; padding:15px; border-bottom:1px solid rgba(255,255,255,0.05);">
                                <div style="color:#8b949e; font-size:14px;">全服職業分布</div>
                                <div id="region-toggle-container"
                                    style="display:flex; gap:5px; background:rgba(0,0,0,0.3); padding:4px; border-radius:6px;">
                                    <button id="region-btn-tw" onclick="switchClassRegion('tw')"
                                        style="background:#3b82f6; color:white; border:none; padding:4px 10px; border-radius:4px; cursor:pointer; font-size:12px; font-weight:bold;">TW
                                        (台灣)</button>
                                    <button id="region-btn-ko" onclick="switchClassRegion('ko')"
                                        style="background:transparent; color:#8b949e; border:none; padding:4px 10px; border-radius:4px; cursor:pointer; font-size:12px; font-weight:bold;">KO
                                        (韓國)</button>
                                </div>
                            </div>
                            <div id="class-dist-chart-container" style="position: relative; height: 450px;">
                                <canvas id="class-dist-chart"></canvas>
                            </div>
                        </div>

                        <!-- Content 3: Server Distribution -->
                        <div id="tab-content-server" style="display:none;">
                            <div
                                style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px; padding:15px; border-bottom:1px solid rgba(255,255,255,0.05);">
                                <div style="color:#8b949e; font-size:14px;">伺服器排行 (Server Distribution)</div>
                                <div id="region-toggle-server-container"
                                    style="display:flex; gap:5px; background:rgba(0,0,0,0.3); padding:4px; border-radius:6px;">
                                    <button id="server-stats-region-btn-tw" onclick="switchServerRegion('tw')"
                                        style="background:#3b82f6; color:white; border:none; padding:4px 10px; border-radius:4px; cursor:pointer; font-size:12px; font-weight:bold;">TW
                                        (台灣)</button>
                                    <button id="server-stats-region-btn-ko" onclick="switchServerRegion('ko')"
                                        style="background:transparent; color:#8b949e; border:none; padding:4px 10px; border-radius:4px; cursor:pointer; font-size:12px; font-weight:bold;">KO
                                        (韓國)</button>
                                </div>
                            </div>
                            <!-- Will be rendered by JS -->
                            <div id="race-dist-container" style="margin-bottom: 20px; padding: 0 15px;"></div>
                            <div id="server-dist-chart-container" style="position: relative;  padding:15px;">
                                <!-- Will be rendered by JS -->
                            </div>
                        </div>
                    </div>

                    <div class="card" style="margin-top: 20px;">
                        <h3>🎖️ 稱號系統加成細項</h3>
                        <div id="title-grid" class="title-grid"></div>
                    </div>


                    <div class="card" style="margin-top: 20px;">
                        <h3>🐾 寵物與翅膀</h3>
                        <div id="petwing-grid" class="grid-box-container"
                            style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));"></div>
                        <h3 id="pet-insight-header" style="margin-top: 25px;">🧠 寵物洞察力</h3>
                        <div id="pet-insight-grid" class="grid-box-container"></div>
                    </div>


                </div>
                <div class="right-column">
                    <div class="health-main-stats-wrapper" style="display:flex; gap:15px; align-items:stretch;">
                        <!-- 機體健檢報告 -->
                        <div id="health-check-card" class="card" style="display:none; flex:1; margin-top:0;"></div>

                        <!-- 主要能力值概覽 (已移動至此) -->
                        <div class="card" id="nav-target-stats" style="flex:1; margin-top:0;">
                            <div class="stat-card-header"
                                style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px; border-bottom:1px solid rgba(255,255,255,0.1); padding-bottom:10px;">
                                <div style="display:flex; flex-direction:column;">
                                    <span id="stat-header-char-id"
                                        style="font-size:24px; font-weight:bold; color:#fff; margin-top:2px; max-width: 250px; word-break: break-all; text-shadow: 0 2px 10px rgba(0,0,0,0.5);">--</span>
                                </div>
                                <div style="display:flex; flex-direction:column; align-items:flex-end;">
                                    <span
                                        style="font-size:12px; color:#ffd700; display:flex; align-items:center; gap:4px;">🏆
                                        裝分</span>
                                    <span id="stat-header-score"
                                        style="font-size:24px; font-weight:bold; color:#fff; text-shadow: 0 0 10px rgba(255,215,0,0.3);">--</span>
                                </div>
                            </div>
                            <div id="stat-main-grid" class="stat-grid-main"></div>
                            <div style="font-size:12px; color:#8b949e; margin-top:5px;padding-left: 15px;">
                                *部分數值受寵物理解度影響無法準確獲得。<br>*被動技能載入較慢請等待十秒讓API讀取資料。</div>
                        </div>
                    </div>

                    <!-- 戰鬥數據分析區塊 (移至下方與全寬) -->
                    <div class="card" id="nav-target-analysis" style="padding:0; overflow:visible;">
                        <div class="card-sticky-header mobile-flex-header">
                            <div class="mobile-vertical-title">
                                <span class="m-icon">⚔️</span>
                                <span>基</span>
                                <span>礎</span>
                                <span>數</span>
                                <span>據</span>
                                <span>分</span>
                                <span>析</span>
                            </div>
                            <div class="mobile-header-content">
                                <div class="desk-title-row"
                                    style="display:flex; justify-content:space-between; align-items:center; padding-right:25px; padding-top:4px; padding-bottom:4px; border-bottom:1px solid rgba(255,255,255,0.05);">
                                    <h3 class="desktop-only-title" style="margin:0; padding:10px 25px; border:none;">⚔️
                                        基礎數據分析</h3>
                                    <div id="combat-analysis-global-controls"
                                        style="display:flex; gap:10px; align-items:center;">
                                    </div>
                                </div>
                                <!-- 增益效果控制面板 (可收合) -->
                                <div id="gain-effect-controls" style="padding:0 25px; margin:0;">
                                    <div onclick="(function(){
                                        const body = document.getElementById('ge-body');
                                        const arrow = document.getElementById('ge-arrow');
                                        if(body.style.display === 'none'){
                                            body.style.display = 'block';
                                            arrow.style.transform = 'rotate(0deg)';
                                        } else {
                                            body.style.display = 'none';
                                            arrow.style.transform = 'rotate(-90deg)';
                                        }
                                    })()"
                                        style="font-size:13px; font-weight:bold; color:#bdc3c7; padding:12px 0; cursor:pointer; display:flex; justify-content:space-between; align-items:center; user-select:none;">
                                        <span>⚙️ 增益效果 | 無法計算寵物理解度</span>
                                        <span id="ge-arrow"
                                            style="font-size:11px; color:#58a6ff; transition:transform 0.3s; transform:rotate(0deg);">▼</span>
                                    </div>
                                    <div id="ge-body">
                                        <div style="display:flex; flex-wrap:wrap; gap:15px;" id="ge-checkbox-container">
                                        </div>
                                        <!-- 翅膀選擇獨立行（不影響 checkbox 排版） -->
                                        <div id="wing-selection-row"
                                            style="display:none; margin-top:10px; padding-top:10px; border-top:1px solid rgba(255,255,255,0.06);">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div> <!-- /card-sticky-header mobile-flex-header -->

                        <!-- 📌 釘選戰力指標的並排佈局容器 (現在獨立於標頭外，可正常捲動) -->
                        <div id="combat-analysis-body" style="display:flex; align-items:flex-start;">
                            <!-- 左側：釘選的戰力指標預覽 (預設隱藏) -->
                            <div id="pinned-stats-panel"
                                style="display:none; width:200px; flex-shrink:0; border-right:1px solid rgba(255,255,255,0.08); background:rgba(0,0,0,0.2); padding:12px; position:sticky; top:4px; align-self:flex-start; max-height:calc(100vh - 20px); overflow-y:auto;">
                            </div>
                            <!-- 右側：原本的基礎數據分析 -->
                            <div style="flex:1; min-width:0;">
                                <div id="combat-stats-grid" class="grid-box-container"
                                    style="padding:5px 25px 25px 25px;">
                                </div>
                            </div>
                        </div>



                        <div class="card" id="nav-target-skill">
                            <h3>⚔️ 技能等級分解</h3>
                            <div class="sk-label">▶ 主動技能</div>
                            <div id="sk-act" class="skill-list"></div>
                            <div class="sk-label">▶ 被動技能</div>
                            <div id="sk-pas" class="skill-list"></div>
                            <div class="sk-label">▶ 特殊/烙印技能</div>
                            <div id="sk-stigma" class="skill-list"></div>
                        </div>

                        <div class="card">
                            <h3>🎴 魔力聖物系統細項</h3>
                            <div id="arcana-grid" class="grid-box-container"
                                style="grid-template-columns: repeat(3, 1fr);">
                            </div>
                            <h3>🔱 套裝效果全覽</h3>
                            <div id="set-bonus-grid" class="grid-box-container"
                                style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));"></div>
                        </div>
                    </div>
                </div>

                <!-- 手機版快速導覽列 (因 CSS 已包含 #mobile-quick-nav 設定，所以會自動在手機版顯示並置底) -->
                <div id="mobile-quick-nav">
                    <a href="#nav-target-role" class="nav-btn">

                        <span>角色</span>
                    </a>
                    <a href="#nav-target-equip" class="nav-btn">

                        <span>裝備</span>
                    </a>
                    <a href="#nav-target-index" class="nav-btn">

                        <span>健檢</span>
                    </a>
                    <a href="#nav-target-stats" class="nav-btn">

                        <span>指標</span>
                    </a>
                    <a href="#nav-target-analysis" class="nav-btn">

                        <span>分析</span>
                    </a>
                    <a href="#nav-target-skill" class="nav-btn">

                        <span>技能</span>
                    </a>
                </div>

            </div>

        </div>

        <!-- 引入核心功能腳本 -->
        <script src="js/skill-api.js?v=99"></script>
        <script src="js/equipment-score.js?v=UI_FIX_FINAL"></script>
        <script src="js/health_check.js"></script>
        <script src="js/peek_score.js?v=score_colors_v5"></script>
        <script src="js/aion.js?v=v_tooltip_godstone_v6"></script>
        <script src="js/class_distribution.js"></script>
        <script src="js/server_stats.js"></script>
        <!-- 裝備詳情彈窗 -->
        <div id="equip-tooltip-overlay" class="tooltip-overlay" onclick="closeEquipTooltip(event)">
            <div class="equip-tooltip" id="equip-tooltip-content" onclick="event.stopPropagation()">
                <!-- 動態生成內容 -->
            </div>
        </div>

        <!-- 📓 作者日記彈窗 -->
        <div id="diary-overlay" class="diary-overlay" onclick="window.closeAuthorDiary()">
            <div class="diary-modal" onclick="event.stopPropagation()">
                <div class="diary-header">
                    <div style="display:flex; align-items:center; gap:10px;">
                        <span style="font-size:20px;">📓</span>
                        <h3 style="margin:0; border:none; padding:0; color:var(--gold-bright);">作者開發日記 & 公告</h3>
                    </div>
                    <div class="diary-close" onclick="window.closeAuthorDiary()">×</div>
                </div>
                <div class="diary-body" style="scrollbar-width: none;">
                    <!-- 日記條目 -->
                    <div class="diary-item">
                        <!--<div class="diary-date">2026-02-26</div>-->
                        <div class="diary-title">⭐關於作者</div>
                        <div class="diary-text">
                            這是一個人的興趣，也是一群人的工具。<br>網站與官方無合作關係，don1 會持續更新，直到冒險結束的那一天。
                        </div>
                    </div>
                    <div class="diary-item">
                        <div class="diary-date">2026-03-02</div>
                        <div class="diary-title">✨ 近期改動內容</div>
                        <div class="diary-text">
                            1.[修正]基礎分析-細項跑版問題。<br>
                            2.[修正]基礎分析-重複裝備認列細項問題。<br>
                            3.[優化]簡易裝備-突破能力值品階視覺效果。<br>
                            4.[許願]-增加防禦力%係數於戰力指標。<br>
                            5.[新增]-基礎分析-最大攻擊力、最小攻擊力。
                        </div>
                    </div>
                    <div class="diary-item">
                        <!--<div class="diary-date">2026-02-24</div>-->
                        <div class="diary-title">🛡️ 正在向作者許願.代辦</div>
                        <div class="diary-text">
                            ■ | 建置角色比較系統---沒空<br>
                            ■ | 優化屬性到達靈界值提示色---預計。<br>
                            ■ | 設計磨石部位統計與優化建議--構想。
                        </div>
                    </div>
                </div>
                <div class="diary-footer">
                    作者：don1 | 人類(⌓‿⌓)，有些功能不是做不到，是打太多資料會被鎖。
                </div>
            </div>
        </div>

        <!-- 💡 計算說明彈窗 -->
        <div id="guide-overlay" class="diary-overlay" onclick="window.closeCalculationGuide()">
            <div class="diary-modal" onclick="event.stopPropagation()">
                <div class="diary-header">
                    <div style="display:flex; align-items:center; gap:10px;">
                        <span style="font-size:20px;">💡</span>
                        <h3 style="margin:0; border:none; padding:0; color:var(--gold-bright);">戰力指標與增益效果計算說明</h3>
                    </div>
                    <div class="diary-close" onclick="window.closeCalculationGuide()">×</div>
                </div>
                <div class="diary-body">
                    <div class="diary-item">
                        <div class="diary-title">1. 增益效果分類</div>
                        <div class="diary-text">
                            • <b>數值類</b>：基礎值、持有、石柱。勾選後數值會直接<b>累加</b>進戰力指標。<br>
                            • <b>排除類</b>：如「排除 PVE」與「排除守護力」。勾選後會從總分中<b>扣除</b>指定來源。
                        </div>
                    </div>
                    <div class="diary-item">
                        <div class="diary-title">2. 戰力計算公式</div>
                        <div class="diary-text">
                            最終數字 = <b>板塊分</b> + <b>裝備分</b> + <b>強化分</b> + <b>其他分</b>。<br>
                            <div style="margin-top:10px; color:#fff; font-weight:bold; font-size:13px;">
                                收集來源：系統會把所有來源算出來：
                            </div>
                            <div
                                style="margin-top:5px; padding-left:12px; border-left:2px solid rgba(255,215,0,0.3); font-size:13px; color:#cbd5e1; line-height:1.8;">
                                • <b>板塊分 (boardVal)</b>：七大守護力板塊的總和。<br>
                                • <b>裝備分 (equipVal)</b>：裝備/持有本身能力值 + 翅膀 + 套裝效果。<br>
                                • <b>強化分 (stoneVal)</b>：裝分的磨石與隨機屬性。<br>
                                • <b>其他分 (otherVal)</b>：稱號 + 被動技能 + 您勾選的「數值類」增益。
                            </div>
                        </div>
                    </div>
                    <div class="diary-item">
                        <div class="diary-title">3. 明細與 UI 連動</div>
                        <div class="diary-text">
                            • <b>增益明細</b>： <b>ⓘ</b> 符號可查看各板塊具體增加與扣除數值。<br>
                            • <b>過濾清單</b>：開啟排除功能後，下方屬性明細清單會自動隱藏相關項目行。
                        </div>
                    </div>
                </div>
                <div class="diary-footer">
                    *資料依官方回傳 API 基礎數據進行即時計算
                </div>
            </div>
        </div>
</body>

</html>