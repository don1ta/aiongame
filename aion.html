<!DOCTYPE html>
<html lang="zh-Hant-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="referrer" content="no-referrer">
    <title>Aion2 高階解析 - 角色名稱快速查詢版</title>
    <!-- 引入外部 CSS -->
    <link rel="stylesheet" href="css/aion.css?v=anti_shake_v1">
    <link rel="stylesheet" href="css/search.css?v=score_colors_v4">

    <!-- 引入共用配置與圖表庫 -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script
        src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>

</head>


<body>
    <div id="loading" class="loading-overlay">⌛ 正在從伺服器獲取數據，請稍候...</div>

    <div class="container">
        <div class="input-area">
            <h2 style="color:var(--gold); margin-top:0; text-align: center;">💎 Aion2 角色數據查詢系統</h2>

            <div class="import-section">
                <div style="font-size: 14px; color: var(--gold); font-weight: bold;">🔍 方法 A：快速角色查詢</div>
                <div class="api-input-group">
                    <input type="text" id="charNameInput" placeholder="輸入角色名稱 (例如: 我愛小紅線)..." oninput="fetchFromApi()"
                        onkeydown="if(event.key === 'Enter') fetchFromApi()" autocomplete="off">



                    <button class="btn-api" onclick="fetchFromApi()" style="display:none;">立即查詢</button>
                </div>

                興趣製作非商業用途，請勿用於營利行為，資料有誤依官方為主。
            </div>
        </div>

        <!-- 搜尋結果區塊 -->
        <div id="search-results" class="search-results-grid" style="display:none;"></div>

        <div id="main-content" class="dashboard">
            <div class="header-combine-card">
                <div id="new-profile-header" class="profile-new-header" style="display:none;"></div>
                <div id="p-percentile-new" class="percentile-grid-new"></div>
            </div>

            <div class="card" style="padding: 15px 25px;">
                <div id="equipment-header" class="collapsible-header collapsed" onclick="toggleEquipmentList()"
                    style="margin-top: 0; background: transparent; border: none; padding: 0;">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <h3 style="margin: 0; border: none; padding: 0;">武器清單</h3>
                    </div>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <span style="font-size: 12px; color: #8b949e;">(點擊展開/收合)</span>
                        <span id="equipment-toggle-icon" class="toggle-icon" style="transform: rotate(-90deg);">▼</span>
                    </div>
                </div>

                <div id="equipment-wrapper" class="collapsible-content collapsed" style="margin-top: 20px;">
                    <div class="stat-tabs-header" style="margin-bottom: 20px;">
                        <div id="tab-btn-equip-simple" class="stat-tab-btn active" onclick="switchEquipTab('simple')">
                            簡易
                        </div>
                        <div id="tab-btn-equip-detail" class="stat-tab-btn" onclick="switchEquipTab('detail')">
                            完整</div>
                    </div>

                    <div id="equip-tab-simple">
                        <div class="section-header" id="armor-header-simple">武器與防具</div>
                        <div id="equip-armor-list-simple" class="grid-box-container"
                            style="grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));"></div>
                        <div class="section-header" id="accessory-header-simple">飾品與配件</div>
                        <div id="equip-accessory-list-simple" class="grid-box-container"
                            style="grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));"></div>
                    </div>

                    <div id="equip-tab-detail" style="display:none;">
                        <div class="section-header" id="armor-header">武器與防具</div>
                        <div id="equip-armor-list"></div>
                        <div class="section-header" id="accessory-header">飾品與配件</div>
                        <div id="equip-accessory-list"></div>
                    </div>
                </div>
            </div>

            <div class="main-layout-wrapper">
                <div class="left-column">

                    <div class="stats-source-wrapper"
                        style="display:flex; gap:15px; align-items:stretch; flex-direction:column;">
                        <div class="card" style="flex:1;">

                            <div id="equip-source-grid"></div>
                            「職業不同、實戰價值」會影響評分公正性是合理的。
                        </div>


                    </div>


                    <!-- Toggle Tabs for History vs Class Distribution -->
                    <div class="card">
                        <div class="card-header-tabs"
                            style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px; border-bottom:1px solid rgba(255,255,255,0.1); padding-bottom:10px;">
                            <div style="display:flex; gap:15px;">
                                <div id="tab-btn-trend" class="stat-tab-btn active"
                                    onclick="switchMainChartTab('trend')">📊 歷史趨勢</div>
                                <div id="tab-btn-class" class="stat-tab-btn" onclick="switchMainChartTab('class')">👥
                                    職業分布</div>
                                <div id="tab-btn-server" class="stat-tab-btn" onclick="switchMainChartTab('server')">🏢
                                    全伺服器</div>
                            </div>
                        </div>

                        <div id="tab-content-trend" style="display:block;">
                            <div id="p-ranking-new" class="rank-grid-new" style="margin-top:0;"></div>
                            <div id="trend-chart-container"
                                style="position: relative; height: 350px; margin-top: 15px;">
                                <canvas id="trend-chart"></canvas>
                            </div>
                            <div id="trend-info"
                                style="margin-top: 15px; font-size: 13px; color: #8b949e; text-align: center;"></div>
                        </div>


                        <div id="tab-content-class" style="display:none;">
                            <div
                                style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px; padding:15px; border-bottom:1px solid rgba(255,255,255,0.05);">
                                <div style="color:#8b949e; font-size:14px;">全服職業分布</div>
                                <div id="region-toggle-container"
                                    style="display:flex; gap:5px; background:rgba(0,0,0,0.3); padding:4px; border-radius:6px;">
                                    <button id="region-btn-tw" onclick="switchClassRegion('tw')"
                                        style="background:#3b82f6; color:white; border:none; padding:4px 10px; border-radius:4px; cursor:pointer; font-size:12px; font-weight:bold;">TW
                                        (台灣)</button>
                                    <button id="region-btn-ko" onclick="switchClassRegion('ko')"
                                        style="background:transparent; color:#8b949e; border:none; padding:4px 10px; border-radius:4px; cursor:pointer; font-size:12px; font-weight:bold;">KO
                                        (韓國)</button>
                                </div>
                            </div>
                            <div id="class-dist-chart-container" style="position: relative; height: 450px;">
                                <canvas id="class-dist-chart"></canvas>
                            </div>
                        </div>

                        <!-- Content 3: Server Distribution -->
                        <div id="tab-content-server" style="display:none;">
                            <div
                                style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px; padding:15px; border-bottom:1px solid rgba(255,255,255,0.05);">
                                <div style="color:#8b949e; font-size:14px;">伺服器排行 (Server Distribution)</div>
                                <div id="region-toggle-server-container"
                                    style="display:flex; gap:5px; background:rgba(0,0,0,0.3); padding:4px; border-radius:6px;">
                                    <button id="server-stats-region-btn-tw" onclick="switchServerRegion('tw')"
                                        style="background:#3b82f6; color:white; border:none; padding:4px 10px; border-radius:4px; cursor:pointer; font-size:12px; font-weight:bold;">TW
                                        (台灣)</button>
                                    <button id="server-stats-region-btn-ko" onclick="switchServerRegion('ko')"
                                        style="background:transparent; color:#8b949e; border:none; padding:4px 10px; border-radius:4px; cursor:pointer; font-size:12px; font-weight:bold;">KO
                                        (韓國)</button>
                                </div>
                            </div>
                            <!-- Will be rendered by JS -->
                            <div id="race-dist-container" style="margin-bottom: 20px; padding: 0 15px;"></div>
                            <div id="server-dist-chart-container" style="position: relative;  padding:15px;">
                                <!-- Will be rendered by JS -->
                            </div>
                        </div>
                    </div>

                </div>
                <div class="right-column">
                    <div class="health-main-stats-wrapper" style="display:flex; gap:15px; align-items:stretch;">
                        <!-- 機體健檢報告 -->
                        <div id="health-check-card" class="card" style="display:none; flex:1; margin-top:0;"></div>

                        <!-- 主要能力值概覽 (已移動至此) -->
                        <div class="card" style="flex:1; margin-top:0;">
                            <div class="stat-card-header"
                                style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px; border-bottom:1px solid rgba(255,255,255,0.1); padding-bottom:10px;">
                                <div style="display:flex; flex-direction:column;">
                                    <span id="stat-header-char-id"
                                        style="font-size:24px; font-weight:bold; color:#fff; margin-top:2px; max-width: 250px; word-break: break-all; text-shadow: 0 2px 10px rgba(0,0,0,0.5);">--</span>
                                </div>
                                <div style="display:flex; flex-direction:column; align-items:flex-end;">
                                    <span
                                        style="font-size:12px; color:#ffd700; display:flex; align-items:center; gap:4px;">🏆
                                        裝分</span>
                                    <span id="stat-header-score"
                                        style="font-size:24px; font-weight:bold; color:#fff; text-shadow: 0 0 10px rgba(255,215,0,0.3);">--</span>
                                </div>
                            </div>
                            <div id="stat-main-grid" class="stat-grid-main"></div>
                            <div style="font-size:12px; color:#8b949e; margin-top:10px;">
                                *套裝效果未列入、生命力與防禦力受寵物理解度影響無法準確獲得。<br>*被動吃api需要等待時間吃資料。</div>
                        </div>
                    </div>

                    <!-- 戰鬥數據分析區塊 (移至下方與全寬) -->
                    <div class="card" style="padding:0; overflow:visible;">
                        <div class="card-sticky-header">
                            <div
                                style="display:flex; justify-content:space-between; align-items:center; padding-right:25px; padding-top:2px; padding-bottom:2px; border-bottom:1px solid rgba(255,255,255,0.05);">
                                <h3 style="margin:0; padding:12px 25px; border:none;">⚔️ 基礎數據分析</h3>
                                <div id="combat-analysis-global-controls"
                                    style="display:flex; gap:10px; align-items:center;">
                                </div>
                            </div>
                            <!-- 增益效果控制面板 -->
                            <div id="gain-effect-controls" style="padding:15px 25px; margin:0;">
                                <div style="font-size:13px; font-weight:bold; color:#bdc3c7; margin-bottom:10px;">⚙️
                                    增益效果</div>
                                <div style="display:flex; flex-wrap:wrap; gap:15px;" id="ge-checkbox-container"></div>
                                <!-- 翅膀選擇獨立行（不影響 checkbox 排版） -->
                                <div id="wing-selection-row"
                                    style="display:none; margin-top:10px; padding-top:10px; border-top:1px solid rgba(255,255,255,0.06);">
                                </div>
                            </div>
                        </div>
                        <div id="combat-stats-grid" class="grid-box-container" style="padding:5px 25px 25px 25px;">
                        </div>
                    </div>



                    <div class="card">
                        <h3>⚔️ 技能等級分解</h3>
                        <div class="sk-label">▶ 主動技能</div>
                        <div id="sk-act" class="skill-list"></div>
                        <div class="sk-label">▶ 被動技能</div>
                        <div id="sk-pas" class="skill-list"></div>
                        <div class="sk-label">▶ 特殊/烙印技能</div>
                        <div id="sk-stigma" class="skill-list"></div>
                    </div>

                    <div class="card">
                        <h3>🎴 魔力聖物系統細項</h3>
                        <div id="arcana-grid" class="grid-box-container"
                            style="grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));"></div>
                        <h3>🔱 套裝效果全覽</h3>
                        <div id="set-bonus-grid" class="grid-box-container"
                            style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));"></div>
                        <h3>🐾 寵物與翅膀</h3>
                        <div id="petwing-grid" class="grid-box-container"
                            style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));"></div>
                    </div>
                    <h3>🎖️ 稱號系統加成細項</h3>
                    <div id="title-grid" class="title-grid"></div>

                    <h3 id="pet-insight-header" style="margin-top: 25px;">🧠 寵物洞察力</h3>
                    <div id="pet-insight-grid" class="grid-box-container"></div>
                </div>
            </div>
        </div>

    </div>

    <!-- 引入核心功能腳本 -->
    <script src="js/skill-api.js?v=99"></script>
    <script src="js/equipment-score.js?v=UI_FIX_FINAL"></script>
    <script src="js/health_check.js"></script>
    <script src="js/peek_score.js?v=score_colors_v5"></script>
    <script src="js/aion.js?v=score_colors_v5"></script>
    <script src="js/class_distribution.js"></script>
    <script src="js/server_stats.js"></script>
</body>

</html>